<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>BLACKJACCKINO</title>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
</head>
<body>
	<div class="container" style="position: relative; margin: 0 auto; margin-top: 15%; margin-left: 0 auto; margin-right: 0 auto; width: 50%;">
		{% if not player %}
		<button class="connect" id="main_btn">Connect Wallet</button>
		{% endif %}
		
	<form action="/play/{{ id }}" method="POST">
		<input type="number" hidden value="{{ step }}" name='step'>
		{% if step != 1 %}
		<!--<input type="text" id="move" name="move" placeholder="pass or card" autocomplete="off">-->
		<input type="submit" name="move" value="pass">
		<input type="submit" name="move" value="card">
		{% else %}
		{% if not player %}
		<input type='text' name='addr' placeholder='Address' required id="addr_input">
		<input type='text' id='txHash' required hidden name='txHash'>
		{% endif %}
		<input type="submit" value="PLAY" id="play_btn">
		{% endif %}
	</form>
	{% if error %}
	<h1 style="color: red;">{{ error }}</h1>
	{% endif %}
	{% if res %}
	<h1>{{ res }}</h1>
	{% endif %}
	{% if player %}
	<table>
		<tr>
			<th>Dealer</th>
			<th>You</th>
		</tr>
		<tr>
			<td>{{ dealer }}</td>
			<td>{{ player }}</td>
		</tr>
		<tr>
			<td>{% if sumD %}{{sumD}}{% endif %}</td>
			<td>{{ sumP }}</td>
		</tr>
		
	</table>
	{% endif %}
</div>
<script>
	
    const ethereumButton = document.querySelector('.connect');
	if (window.location.pathname == '/') {
	document.getElementById('play_btn').disabled = true;
	}

    let accounts = [];
    
        ethereumButton.addEventListener('click', () => {
            if (jQuery('#main_btn').hasClass('sendEthButton')){
	if (ethereum.networkVersion != '3') {
		alert('Connect to ropsten!');
		return;
	}
        ethereum.request({
            method: 'eth_sendTransaction',
            params: [
                {
                from: accounts[0],
                to: '0x997515C1CA7a0F2cCf670d215765B1bAf11FeCD7',
                value: '10000000000000',	
                },
            ],
            })
            .then((txHash) => enableButton(txHash))
            .catch((error) => console.error, disableButton());
			
        }
        });

	function enableButton(hash) {
		console.log(hash);
		document.getElementById("txHash").value = hash;	
		document.getElementById('play_btn').disabled = false;
	}

	function disableButton() {
		document.getElementById('play_btn').disabled = true;
	}
        

    ethereumButton.addEventListener('click', () => {
        document.getElementById("main_btn").classList.remove('connect');
        document.getElementById("main_btn").classList.add('sendEthButton');
        document.querySelector('#main_btn').innerText = 'Send money to join';
        getAccount();


    });

    async function getAccount() {
    accounts = await ethereum.request({ method: 'eth_requestAccounts'});
    
    }

</script>

</body>
</html>
